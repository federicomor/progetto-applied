---
title: "PERMANOVA"
output: 
date: "2023-04-16"
---

# NOTES

-   Permutational tests are computationally expensive: we need a much smaller dataset than the one we're working on. We may reduce our dataset grouping by schools. Considering less countries does not work: still too many rows for a permutational test

# REFERENCES

-   <https://uw.pressbooks.pub/appliedmultivariatestatistics/chapter/permanova/>
-   working with large datasets and parallel computing: <https://cran.r-project.org/web/views/HighPerformanceComputing.html>

# PRELIMINARY STUFF

```{r}
#directories
working_dir = "/Users/marcogalliani/Desktop/progetto-applied"
complete_data_dir = "/Users/marcogalliani/Desktop/PISA-dataset/PISA_file_sav"
clean_data_dir = "/Users/marcogalliani/Desktop/PISA-dataset"
include_dir = paste(working_dir,"/src/include/Utilities.R",sep="")

#including utilities
source(include_dir)
#importing the dataset
pisa_data <- read.csv(file=paste(clean_data_dir,"/pisa-woNA.csv",sep=""))
```

```{r}
#select only ICT moments fot the moment
library(dplyr)
pisa_data <- pisa_data %>% dplyr::select(all_of(c("CNT",stu_ICT,sch_ICT)))

#dropping spain
pisa_data <- pisa_data %>% filter(CNT!="ESP")
```

# NON-PARAMETRIC MANOVA

## ADONIS2 

Computationally expensive: need a really small dataset

```{r}
library(parallel)
library(vegan)

#try with smaller datasets
small_pisa <- pisa_data %>% filter(CNT %in% c("FRA","SWE"))

result <- adonis2(formula = small_pisa[,c(stu_ICT,"RATCMP1")]~CNT, 
                  data = small_pisa, 
                  method = "euclidean",
                  parallel = detectCores())
```

## PERMANOVA

Computationally expensive: need a really small dataset

```{r}
library(PERMANOVA)
small_pisa <- pisa_data %>% filter(CNT %in% c("FRA","IRL"))

#standardize data
pisa_std <- IniTransform(select_if(small_pisa,is.numeric)) 

#compute the matrix of distances
D <- DistContinuous(pisa_std) 
#adding grouping columns to the transformed data
pisa_std["CNT"] <- as.factor(small_pisa$CNT) 

#PERMANOVA
perm_pisa <- PERMANOVA(D,pisa_std$CNT)
```

## KRUSKAL

Another non-parametric test, less computationally expensive

```{r}
fit <- kruskal.test(ICTCLASS~CNT, data=pisa_data)
fit


```
