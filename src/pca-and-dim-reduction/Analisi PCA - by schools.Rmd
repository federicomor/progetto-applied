---
title: "PISA dataset na exploration"
output: 
editor_options: 
  chunk_output_type: inline
---

# Map for variable meaning
```{r}
source("../include/Utilities.R")
```


# Setup
```{r}
#variabili finite nel dataset
tec=c("ICTCLASS","ICTHOME","ICTOUTSIDE","ICTRES","AUTICT","COMPICT","INTICT","ENTUSE","HOMESCH","USESCH")
psi=c("ATTLNACT","EMOSUPS","COMPETE","EUDMO","GFOFAIL","SWBP","RESILIENCE","BELONG","BEINGBULLIED","PERFEED")
clt=c("JOYREAD","CULTPOSS","HEDRES","SCREADCOMP","LMINS","MMINS")
fam=c("WEALTH","ESCS","HOMEPOS","BFMJ2","BMMJ1","HISCED","HISEI")
tch=c("TEACHINT","TEACHSUP","STIMREAD")
sch=c("PERCOMP","PERCOOP","ICTSCH","RATCMP1") #,"RATCMP2")

df=read.csv("../../data/pisa-woNA_school_final.csv")
colnames(df)
head(df)
df=df[,-c(1)] #remove  X (index) column

sort(colnames(df[,-c(1,2,3)])) == sort(c(tec,psi,clt,fam,tch,sch))
#c'è tutto ora
#variabili nuove
colnames(df)[c(1,2,3)]

head(df$schID)
length(unique(df$schID))
dim(df) #è davvero un id allora

head(df$gender_prop) #??

df_tec = df[,colnames(df) %in% tec]
df_psi = df[,colnames(df) %in% psi]
df_clt = df[,colnames(df) %in% clt]
df_fam = df[,colnames(df) %in% fam]
df_tch = df[,colnames(df) %in% tch]
df_sch = df[,colnames(df) %in% sch]
```

# States
```{r}
states = unique(df$CNT)
len = length(unique(df$CNT))
hcl.pals()
col.ramp = hcl.colors(len, palette = "viridis")
```

## SWBP for states
```{r}
boxplot(df$SWBP ~ df$CNT,las=2, col=col.ramp, main="SWBP for states, by-school dataset")
```

## SWBP for schools in states
```{r}
unique(df$CNT)

for(state in states){
	plot(df$SWB[which(df$CNT==state)] ~ df$schID[which(df$CNT==state)], main=paste("SWBP for the schools in",state))
}
```

## Comparison of the means in states
```{r}
psi=c("ATTLNACT","EMOSUPS","COMPETE","EUDMO","GFOFAIL","SWBP","RESILIENCE","BELONG","BEINGBULLIED","PERFEED")
for (val in psi){
	print(what_is[[val]])
}
# pos_val =c("ATTLNACT","EMOSUPS","COMPETE","EUDMO","SWBP","RESILIENCE","BELONG","PERFEED")
# neg_val =c("GFOFAIL","BEINGBULLIED")

# plot(df$SWB[which(df$CNT==state)] ~ df$schID[which(df$CNT==state)], main=paste("SWBP for the schools in",state))
vec_medie = rep(0,length(unique(states)))
it=0
for(state in states){
	vec_medie[it] = mean(df$SWB[which(df$CNT==state)])
	it=it+1
}
length(vec_medie)
length(states)
delta=1/20
plot(1:length(unique(states)),vec_medie, main="SWBP mean in states, by-school dataset",
	 ylim=c(min(vec_medie),max(vec_medie)+delta), col=col.ramp, pch=19)
x=1
for(state in states){
	text(x,vec_medie[x]+delta,state)
	x=x+1
}
states
```

# Gaussianity test
```{r}
unique(df$CNT)
states

for(state in states){
	qqnorm(df$SWB[which(df$CNT==state)], main=paste("SWBP qqnorm for the schools in",state))
	qqline(df$SWB[which(df$CNT==state)], main=paste("SWBP qqnorm for the schools in",state))
}
for(state in states){
	print(paste0(state,"'s pvalue for gaussianity: ",shapiro.test(df$SWB[which(df$CNT==state)])$p.value))
}
# Sembra in effetti si possa sistemare, rimuovendo tipo gli outlier, e fare manova sulle medie di SWBP
```


# PCA effettiva (da fare)
```{r}

```





















# Andrews plot, piccolo intermezzo
```{r}
# install.packages("pracma")
library(pracma)
len_states=length(states)
len_psi=length(psi)
A=matrix(nrow = len_states, ncol = len_psi)
# A[,1]=states # morally


for(i in 1:len_states){
	for(j in 1:len_psi){
		A[i,j]=mean(df[which(df$CNT==states[i]),psi[j]])
	}
}
andrewsplot(A, f=as.factor(states), style = "pol", scaled = FALSE, npts = 101)
andrewsplot(A, f=as.factor(states), style = "cart", scaled = FALSE, npts = 101)
# ci fosse la legenda, ma andrewsplot non sembra implementarla, quindi i colori boh
```


