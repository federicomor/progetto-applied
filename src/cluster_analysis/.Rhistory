k_chosen = 3
plot(data.hclust, main=paste(name_dist_chosen,name_linkage_chosen), hang=-0.1, xlab='', labels=F, cex=0.6, sub='')
rect.hclust(data.hclust, k=k_chosen)
# How to cut a dendrogram?
# We generate vectors of labels through the command cutree()
cluster.cutree = cutree(data.hclust, k=k_chosen)
table(cluster.cutree)
## How good is the clustering?
# Cophenetic Matrices
coph.mat <- cophenetic(data.hclust)
# Cophenetic Coefficients
coph.coeff = cor(data.dist, coph.mat)
coph.coeff
#plot(measures[,1],measures[,3],col=cluster.cutree+1)
#plot3d(measures, size=3, col=cluster.cutree+1, aspect = F)
## **2.** Saving the clustering as factors
data_clustered[,cat_var_names[counter_names]] = as.factor(cluster.cutree)
counter_names = counter_names+ 1
}
head(data_clustered)
country_names <- unique(data_clustered$CNT)
g=16
indeces = list()
for (jj in 1:g){
indeces[jj] <- list(which(data_clustered$CNT == country_names[jj]))
}
n_list = list()
for(j in 1:g) {
n_list[j] = list(length(indeces[[j]]))
}
####
# per ogni cluster voglio vedere quale percentuale di scuole della stessa nazione ricadono nello stesso
percent_list = list()
counter = 0
for(k in cat_var_names){ # categories
counter = counter +1
percent_list_mid = list()
counter2=0
for(i in 1:k_chosen){ # clusters
counter2 = counter2 +1
percent = c()
for(j in 1:g){ # countrys
temp = length(data_clustered[which(data_clustered[,k]==i & data_clustered$CNT==country_names[j]),1])
temp = temp/n_list[[j]]
percent = c(percent,temp)
}
percent_list_mid[counter2]=list(percent)
}
percent_list[counter] = list(percent_list_mid)
}
#for(kk in 1:6){
kk = 3
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
x11()
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
#}
data_to_cluster = measures[,c(clt)]
data_to_cluster = measures[,tec]
tec
measures
#for(kk in 1:6){
kk = 3
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
x11()
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
#}
for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
x11()
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
}
pdf("cluster_country_proportions.pdf")
for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
x11()
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
}
dev.off()
pdf("cluster_country_proportions.pdf")
for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
}
dev.off()
pdf("cluster_country_proportions.pdf")
for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
}
dev.off()
pdf("cluster_country_proportions.pdf")
dev.off()
}
dev.off()
dev.off()
pdf("cluster_country_proportions.pdf")
for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
}
dev.off()
#pdf("cluster_country_proportions.pdf")
x11()
par(mfrow=c(2,3))
for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
}
#dev.off()
x11()
par(mfrow=c(2,3))
kk=1
#for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
#}
#dev.off()
kk=2
#for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
#}
#dev.off()
#pdf("cluster_country_proportions.pdf")
x11()
par(mfrow=c(2,3))
kk=1
#for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
#}
#dev.off()
kk=2
#for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
#}
#dev.off()
pdf("cluster_country_proportions.pdf")
for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
}
dev.off()
#pdf("cluster_country_proportions.pdf")
for(kk in 1:6){
# Create sample data
group_percentages <- percent_list[[kk]]
groups_names = c()
for (i in 1:k_chosen){
groups_names = c(groups_names,paste("Group",i))
}
# Convert percentages to data frame
df <- data.frame(
country = rep(country_names, each = k_chosen),
group = rep(groups_names, times = length(country_names)),
percentage = NA
)
for(i in country_names){
for(j in groups_names){
df[which((df$group==j) & (df$country==i)),3] = group_percentages[[which(groups_names==j)]][which(country_names==i)]*100
}
}
Sys.sleep(1)
x11()
# Create stacked bar chart
ggplot(df, aes(x = country, y = percentage, fill = group)) +
geom_bar(stat = "identity") +
labs(title = "Proportion of Schools in Each Group by Country",
x = "Country",
y = "Proportion") +
scale_fill_manual(values = c("#E69F00", "#56B4E9", "#009E73"),
labels = groups_names) +
geom_text(aes(label = paste0(round(percentage,2), "%")),
position = position_stack(vjust = 0.5))
}
#dev.off()
df
measures
for(i in 1:3){
x11()
plot(measures[,1],measures[,3],col=cluster.cutree+1)
}
for(i in 1:3){
x11()
plot(measures[,1],measures[,2],col=cluster.cutree+1)
}
